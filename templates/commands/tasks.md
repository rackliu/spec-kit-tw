---
description: 基於可用的設計文件, 為功能特性生成可執行的、按依賴關係排序的 tasks.md 檔案.
handoffs:
  - label: 分析一致性
    agent: speckit.analyze
    prompt: 執行專案一致性分析
    send: true
  - label: 實施專案
    agent: speckit.implement
    prompt: 實施專案
    send: true
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前, 你**必須**考慮使用者輸入(如果不為空).

## 概述

1. **設定**: 從倉庫根目錄執行 `{SCRIPT}` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表. 所有路徑必須是絕對路徑. 對於引數值中的單引號如 "I'm Groot", 使用轉義語法: 例如 'I'\''m Groot'(或儘可能使用雙引號: "I'm Groot").

2. **載入設計文件**: 從 FEATURE_DIR 讀取: 
   - **必需**: plan.md(技術棧、庫、結構), spec.md(帶優先順序的使用者故事)
   - **可選**: data-model.md(實體), contracts/(API 端點), research.md(決策), quickstart.md(測試場景)
   - 注意: 並非所有專案都有所有文件. 基於可用內容生成任務.

3. **執行任務生成流程**(遵循模板結構): 
   - 載入 plan.md 並提取技術棧、庫、專案結構
   - **載入 spec.md 並提取帶優先順序的使用者故事(P1、P2、P3 等)**
   - 如果存在 data-model.md: 提取實體 → 對映到使用者故事
   - 如果存在 contracts/: 每個檔案 → 對映端點到使用者故事
   - 如果存在 research.md: 提取決策 → 生成設定任務
   - **按使用者故事組織生成任務(重點)**: 
     - 設定任務(所有故事需要的共享基礎設施)
     - **基礎任務(任何使用者故事開始前必須完成的先決條件)**
     - 對於每個使用者故事(按優先順序順序 P1、P2、P3...): 
       - 組合完成該故事所需的所有任務
       - 包含該故事特定的模型、服務、端點、UI 元件
       - 標記哪些任務是 [P] 可並行的
       - 如果請求測試: 包含該故事特定的測試
     - 完善/整合任務(橫切關注點)
   - **測試是可選的**: 僅在功能規格中明確請求或使用者要求 TDD 方法時生成測試任務
   - 應用任務規則: 
     - 不同檔案 = 標記 [P] 表示並行
     - 相同檔案 = 順序執行(無 [P])
     - 如果請求測試: 測試在實現之前(TDD 順序)
   - 按順序編號任務(T001、T002...)
   - 生成顯示使用者故事完成順序的依賴關係圖
   - 為每個使用者故事建立並行執行範例
   - 驗證任務完整性(每個使用者故事都有所有必需任務, 可獨立測試)

4. **生成 tasks.md**: 使用 `templates/tasks-template.md` 作為結構, 填充: 
   - 來自 plan.md 的正確功能名稱
   - 階段 1: 設定任務(專案初始化)
   - 階段 2: 基礎任務(所有使用者故事的阻塞先決條件)
   - 階段 3+: 每個使用者故事一個階段(按 spec.md 中的優先順序順序)
     - 每個階段包括: 故事目標、獨立測試標準、測試(如果請求)、實現任務
     - 每個任務的清晰 [Story] 標籤(US1、US2、US3...)
     - 每個故事內可並行任務的 [P] 標記
     - 每個故事階段後的檢查點標記
   - 最終階段: 完善與橫切關注點
   - 按執行順序編號的任務(T001、T002...)
   - 每個任務的清晰檔案路徑
   - 顯示故事完成順序的依賴關係部分
   - 每個故事的並行執行範例
   - 實現策略部分(MVP 優先, 增量交付)

5. **報告**: 輸出生成的 tasks.md 路徑和摘要: 
   - 總任務數
   - 每個使用者故事的任務數
   - 識別的並行機會
   - 每個故事的獨立測試標準
   - 建議的 MVP 範圍(通常只是使用者故事 1)

任務生成上下文: {ARGS}

tasks.md 應該立即可執行 - 每個任務必須足夠具體, 以便 LLM 可以在沒有額外上下文的情況下完成它.

## 任務生成規則

**重要**: 測試是可選的. 僅當用戶在功能規格中明確請求測試或 TDD 方法時才生成測試任務.

**關鍵**: 任務必須按使用者故事組織, 以實現獨立的實現和測試.

1. **來自使用者故事(spec.md)** - 主要組織方式: 
   - 每個使用者故事(P1、P2、P3...)都有自己的階段
   - 將所有相關元件對映到它們的故事: 
     - 該故事所需的模型
     - 該故事所需的服務
     - 該故事所需的端點/UI
     - 如果請求測試: 該故事特定的測試
   - 標記故事依賴關係(大多數故事應該是獨立的)

2. **來自合約**: 
   - 將每個合約/端點 → 對映到它服務的使用者故事
   - 如果請求測試: 每個合約 → 在該故事階段的實現之前的合約測試任務 [P]

3. **來自資料模型**: 
   - 將每個實體 → 對映到需要它的使用者故事
   - 如果實體服務多個故事: 放在最早的故事或設定階段
   - 關係 → 適當故事階段的服務層任務

4. **來自設定/基礎設施**: 
   - 共享基礎設施 → 設定階段(階段 1)
   - 基礎/阻塞任務 → 基礎階段(階段 2)
     - 範例: 資料庫模式設定、認證框架、核心庫、基礎配置
     - 這些必須在任何使用者故事可以實現之前完成
   - 故事特定的設定 → 在該故事的階段內

5. **排序**: 
   - 階段 1: 設定(專案初始化)
   - 階段 2: 基礎(阻塞先決條件 - 必須在使用者故事之前完成)
   - 階段 3+: 按優先順序順序的使用者故事(P1、P2、P3...)
     - 每個故事內: 測試(如果請求)→ 模型 → 服務 → 端點 → 整合
   - 最終階段: 完善與橫切關注點
   - 每個使用者故事階段應該是一個完整的、可獨立測試的增量

